(exercise-stock)=
# 案例实战：股票价格

:::{note}

本教程已出版为《Flink 原理与实践》，感兴趣的读者请在各大电商平台购买！

<a href="https://item.jd.com/13154364.html"> ![](https://img.shields.io/badge/JD-%E8%B4%AD%E4%B9%B0%E9%93%BE%E6%8E%A5-red) </a>


:::

经过本章的学习，读者应该可以对时间处理有了比较全面的了解，本节继续以股票价格这个场景来实践时间处理相关内容。

## 实验目的

针对具体的业务场景，学习如何设置窗口，如何在窗口上进行计算。

## 实验内容

股票交易场景，我们经常见到名为“K 线”的概念。K 线形如蜡烛，它反应了价格的走势，在一个 K 线内同时记录了开盘价（Open）、最高价（High）、最低价（Low）、收盘价（Close）。这里我们以 5 分钟为一个周期，计算该周期内的 K 线数据，即 5 分钟内的开盘价、最高价、最低价和收盘价（OHLC）。

关于价格，常见的是计算一个时间段内的平均值，考虑到交易量的权重，另外一个经常使用的一个计算价格的方式为交易量加权平均值（Volume Weighted Average Price，VWAP）。它的公式为：

$$
VWAP = \frac{\sum price \times volume}{\sum volume}
$$

## 实验要求

使用你认为合适的算子和函数，完成下面两个程序，使用 `print` 将结果打印输出。你可以根据需要自定义中间数据结构。

* 程序 1：以 5 分钟为一个时间单位，计算其 OHLC 各值。

* 程序 2：以 5 分钟为一个时间单位，计算 VWAP。

## 实验报告

将思路和程序整理后撰写为实验报告。